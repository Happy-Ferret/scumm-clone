$(document).ready(function(){function a(){m=d(),p+=Math.min(1,(m-q)/1e3),b(p),q=m,requestAnimationFrame(a)}function b(){for(var a=0;a<r.length;a++)r[a].move(p)}function c(a,b,c,d){var e=Math.min(c/a,d/b);return{width:a*e,height:b*e}}function d(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}function e(a,b){return a>b?a-b:b-a}function f(a,b){return"undefined"!=typeof b.x?{x:e(a.x,b.x),y:e(a.y,b.y)}:void 0}function g(){this.dest={},this.destX,this.destY,this.move=function(){if("undefined"!=typeof this.destX&&this.destX!=this.x){var a={x:this.x,y:this.y},b={x:this.destX,y:this.destY};console.log(b);var c=f(a,b);console.log(c),this.sprite.clear(),this.sprite.draw(c.x,c.y),this.x=c.x,this.y=c.y}}}function h(){this.items={},this.init=function(){return this.canvas=$("<canvas></canvas>").attr({id:"inv",width:t,height:v}).css({"z-index":9e6,top:u-v}),this.ctx=this.canvas[0].getContext("2d"),this.ctx.fillStyle="rgba(0, 0, 0, 1)",this.ctx.fillRect(0,0,t,v),$("#container").append(this.canvas),this},this.init()}function i(a,b,d){if(this.canvas=$("<canvas></canvas>").attr({id:a,width:t,height:u-v}).css("z-index",d),this.ctx=this.canvas[0].getContext("2d"),0!==b){var e=new Image;e.src=b;var f=this;e.onload=function(){var a=c(this.width,this.height,1e9,w);f.ctx.drawImage(e,0,0,this.width,this.height,0,0,a.width,a.height)}}return this}function j(a){g.call(this),this.prototype=new g,this.x=600,this.y=300,this.inventory=new h,this.scene=a,this.speed=4,o=this,this.init=function(){this.sprite=new l(a),this.sprite.draw(this.x,this.y),r.push(this)},this.init()}function k(a){this.bgLayers=new Array,this.spriteLayers=new Array,this.init=function(){this.getLayers()},this.getLayers=function(){var b=a.imageLayers,c=0;for(var d in b){var e=b[d];for(var f in e)if(e.hasOwnProperty(f)){var g=new i("background"+c,e[f],c);this.bgLayers.push(g),c++}}},this.show=function(){for(var a=0;a<this.bgLayers.length;a++)$("#container").append(this.bgLayers[a].canvas);var b=new i("spritelayer0",0,9999);this.spriteLayers.push(b),$("#container").append(b.canvas);var b=new i("controlLayer",0,9999);$("#container").append(b.canvas),n=this,this.setupControls()},this.setupControls=function(){$("#controlLayer").on("click",function(a){o.destX=a.offsetX,o.destY=a.offsetY,console.log(a)})},this.init()}function l(a){this.x,this.y,this.w=150,this.h=150,this.init=function(){this.ctx=a.spriteLayers[0].ctx,this.ctx.fillStyle="rgb(244,244,244)"},this.draw=function(a,b){this.x=a,this.y=b,this.ctx.fillRect(this.x,this.y,this.w,this.h)},this.clear=function(){this.ctx.clearRect(this.x,this.y,this.w,this.h)},this.init()}var m,n,o,p=0,q=d(),r=new Array;requestAnimationFrame(a);var s={imageLayers:{0:{image:"assets/scenes/mi1street/street.png"}},persPoint:{x:160,y:70}},t=1024,u=768,v=250,w=u-v,x=new k(s);x.show();var y=new j(x);console.log(y)});